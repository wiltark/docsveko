---
title: SystÃ¨me de plugins
description: CrÃ©ation et utilisation de plugins
---

# ğŸ”Œ SystÃ¨me de plugins

Le systÃ¨me de plugins de Veko.js permet dâ€™Ã©tendre facilement les fonctionnalitÃ©s de ton application sans modifier le cÅ“ur du framework. Les plugins peuvent ajouter des routes, des middlewares, des hooks, des commandes CLI, gÃ©rer des donnÃ©es, et bien plus.

## âš™ï¸ Configuration des plugins

Active le systÃ¨me de plugins dans la configuration de ton applicationâ€¯:

```javascript
const app = new App({
  plugins: {
    enabled: true,          // Active le systÃ¨me de plugins
    autoLoad: true,         // Chargement automatique des plugins
    pluginsDir: 'plugins'   // Dossier des plugins
  }
});
```

## ğŸ“¦ Structure dâ€™un plugin

Un plugin est un simple module Node.js exportant un objet avec des propriÃ©tÃ©s et mÃ©thodes spÃ©cifiquesâ€¯:

```javascript
// plugins/mon-plugin.js
module.exports = {
  name: 'mon-plugin',
  version: '1.0.0',
  description: 'Description de mon plugin',
  dependencies: ['autre-plugin'], // Optionnel
  defaultConfig: {
    enabled: true,
    option1: 'valeur'
  },
  async load(app, config, context) {
    // Code dâ€™initialisation du plugin
    context.log('success', 'Plugin chargÃ© !');
    // Ajouter une route
    context.addRoute('get', '/mon-plugin', (req, res) => {
      res.json({ message: 'Hello depuis le plugin !' });
    });
    // Ajouter un middleware
    context.addMiddleware((req, res, next) => {
      req.pluginData = { source: 'mon-plugin' };
      next();
    });
    // Ajouter un hook
    context.hook('route:create', (method, path) => {
      context.log('info', `Route crÃ©Ã©e : ${method} ${path}`);
    });
  },
  async unload(app, config) {
    // Nettoyage lors du dÃ©chargement
    console.log('Plugin dÃ©chargÃ©');
  }
};
```

## ğŸ› ï¸ API du contexte plugin

Chaque plugin reÃ§oit un objet `context` offrant de nombreuses fonctionnalitÃ©sâ€¯:

- **Hooks** : `context.hook('nom', callback)` pour rÃ©agir Ã  des Ã©vÃ©nements (crÃ©ation de route, requÃªte, etc.)
- **Routes** : `context.addRoute('get', '/chemin', handler)`
- **Middlewares** : `context.addMiddleware(fn)`
- **Commandes CLI** : `context.addCommand('nom', handler, 'description')`
- **Logs** : `context.log('type', 'message', 'dÃ©tails')`
- **AccÃ¨s aux autres plugins** : `context.getPlugin('nom')`, `context.listPlugins()`
- **Configuration** : `context.getConfig()`, `context.updateConfig({...})`
- **Stockage persistant** : `context.storage.set('clÃ©', valeur)`, `context.storage.get('clÃ©')`, `context.storage.delete('clÃ©')`

## âœ¨ Exemples de plugins

### Plugin base de donnÃ©es

```javascript
// plugins/database.js
const mongoose = require('mongoose');
module.exports = {
  name: 'database',
  async load(app, config, context) {
    await mongoose.connect(config.uri, config.options);
    context.log('success', 'Connexion MongoDB Ã©tablie');
    app.db = mongoose;
    context.hook('app:stop', async () => {
      await mongoose.disconnect();
      context.log('info', 'Connexion MongoDB fermÃ©e');
    });
  }
};
```

### Plugin authentification

```javascript
// plugins/auth.js
const jwt = require('jsonwebtoken');
module.exports = {
  name: 'auth',
  dependencies: ['database'],
  defaultConfig: {
    secret: 'votre-cle-secrete',
    expiresIn: '24h'
  },
  async load(app, config, context) {
    const authMiddleware = (req, res, next) => {
      const token = req.headers.authorization?.split(' ')[1];
      if (!token) return res.status(401).json({ error: 'Token manquant' });
      try {
        req.user = jwt.verify(token, config.secret);
        next();
      } catch {
        res.status(401).json({ error: 'Token invalide' });
      }
    };
    context.addRoute('post', '/auth/login', async (req, res) => {
      // Validation utilisateur fictive
      const { email, password } = req.body;
      if (email && password) {
        const token = jwt.sign({ email }, config.secret, { expiresIn: config.expiresIn });
        res.json({ token });
      } else {
        res.status(401).json({ error: 'Identifiants invalides' });
      }
    });
    context.addRoute('get', '/auth/profile', authMiddleware, (req, res) => {
      res.json({ user: req.user });
    });
    app.authMiddleware = authMiddleware;
    context.log('success', 'Plugin auth chargÃ©');
  }
};
```

### Plugin cache

```javascript
// plugins/cache.js
const NodeCache = require('node-cache');
module.exports = {
  name: 'cache',
  defaultConfig: {
    stdTTL: 600,
    checkperiod: 120
  },
  async load(app, config, context) {
    const cache = new NodeCache(config);
    const cacheMiddleware = (duration = 300) => (req, res, next) => {
      const key = req.originalUrl;
      const cached = cache.get(key);
      if (cached) return res.json(cached);
      const originalSend = res.json;
      res.json = function(data) {
        cache.set(key, data, duration);
        return originalSend.call(this, data);
      };
      next();
    };
    app.cache = {
      get: (key) => cache.get(key),
      set: (key, value, ttl) => cache.set(key, value, ttl),
      del: (key) => cache.del(key),
      flush: () => cache.flushAll(),
      middleware: cacheMiddleware,
      stats: () => cache.getStats()
    };
    context.addRoute('get', '/cache/stats', (req, res) => {
      res.json(cache.getStats());
    });
    context.log('success', 'Plugin cache chargÃ©');
  }
};
```

## ğŸ”„ Gestion des plugins

- **Chargement manuel** : `await app.loadPlugin('nom', { option: 'valeur' })`
- **DÃ©chargement** : `await app.unloadPlugin('nom')`
- **Liste des plugins** : `app.listPlugins()`
- **Activation/dÃ©sactivation** : `await app.plugins.togglePlugin('nom', true)`
- **Statistiques** : `app.plugins.getStats()`

## ğŸª Hooks disponibles

- `app:init`, `app:start`, `app:stop` â€” DÃ©marrage/arrÃªt de lâ€™application
- `route:load`, `route:create`, `route:created`, `route:delete` â€” Gestion des routes
- `request:start`, `request:end` â€” DÃ©but/fin de requÃªte
- `websocket:connect`, `websocket:disconnect` â€” Connexions WebSocket
- `file:change` â€” Modification de fichier
- `plugin:load`, `plugin:unload` â€” Chargement/dÃ©chargement de plugin
- `error:handle` â€” Gestion des erreurs

---

## ğŸ“š Pour aller plus loin

- [Configuration avancÃ©e](/guides/configuration)
- [Structure du projet](/guides/project-structure)